<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/indexfragment.html :: header( title = 'Monitoreo SpO2')"></head>
<style>
  :root {
    /* Variables for both color schemes */
    --transition-duration: 0.2s;
    --border-radius-small: 6px;
    --border-radius-medium: 10px;
    --border-radius-large: 15px;
  }

  :root {
    --page-background: #fcfcfc;
    --page-color: #ddd;
    --text-color-muted: #000000;
    --graph-background: transparent;
    --graph-color: #1198c1;
    --backdrop-background: rgba(252, 251, 251, 0.3);
    --nav-item-background: #fdfafa;
  }
</style>
<body class="clinic_version">
<!-- END LOADER -->
<header>
  <div th:replace="fragments/indexfragment.html :: navbar"></div>
  <div th:replace="fragments/indexfragment.html :: navbar2"></div>
</header>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
<script>
  var firebaseConfig = {
    apiKey: "AIzaSyDxnoily8MtyE_EbrCrOatA0u0yOjf9yk4",
    authDomain: "netpulse-9e137.firebaseapp.com",
    databaseURL: "https://netpulse-9e137-default-rtdb.firebaseio.com",
    projectId: "netpulse-9e137",
    storageBucket: "netpulse-9e137.appspot.com",
    messagingSenderId: "855387244557",
    appId: "1:855387244557:web:ab3e1ccfbabebcc07d2d44"
  };
  firebase.initializeApp(firebaseConfig);
</script>
<script>
  var lecturaSPO2 = firebase.database().ref('Pulsioximetro/' + 'id/' + '1/' + 'Probando/' + 'spo2');

  lecturaSPO2.on('value', (snapshot) => {
    const data = snapshot.val();
    console.log(data);
    document.getElementById("valorSP").innerHTML = data;
    document.getElementById("valorSP").value = data;
    document.getElementById("valor1spo2").value = data;
    if(document.getElementById("flag").innerHTML === "2"){
      console.log("AHORA SI");
      document.getElementById("registrar").click();
    }else{
      document.getElementById("flag").innerHTML = "2";
    }
    //document.getElementById("registrar").click();
  });
</script>

<div id="home" class="parallax first-section wow fadeIn">
  <div class="container">
    <div class="row">
      <div class="col-md-12 col-sm-12">
        <div class="text-contant">
          <form class="center" method="post" th:action="@{/netpulse/registrarspo2}">
              <div class="row">
                <h1 th:text="${session.usuarioLogueado.nombre}"></h1>
                <h2 class="row" style="color: #002752">Monitoreo %SpO2:</h2><input class="form-control" type="text" id="valorSP" name="valorSP">
              </div>
              <h2 id="flag" style="display:none">0</h2>
              <button type="submit" style="display:none" id="registrar">Registrar</button>
          </form>
        </div>
      </div>
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
  <div class="container">
    <div class="row" >
        <div class="bpm-display-container" style="display: inline-block">
          <div class="bpm-display">
            <output id="valor1spo2" class="bpm-value" title="Heart rate"></output>
            <label>%SpO2</label>
          </div>
        </div>
        <div class="bpm-display-container" style="display: inline-block">
          <div class="bpm-display">
            <output class="bpm-value" title="Heart rate">96</output>
            <label>%SpO2</label>
          </div>
        </div>
      <div class="bpm-display-container" style="display: inline-block">
        <div class="bpm-display">
          <output class="bpm-value" title="Heart rate">96</output>
          <label>%SpO2</label>
        </div>
      </div>
      <div class="bpm-display-container" style="display: inline-block">
        <div class="bpm-display">
          <output class="bpm-value" title="Heart rate">94</output>
          <label>%SpO2</label>
        </div>
      </div>
      <div class="bpm-display-container" style="display: inline-block">
        <div class="bpm-display">
          <output class="bpm-value" title="Heart rate">98</output>
          <label>%SpO2</label>
        </div>
      </div>
    </div>
  </div>
</div>
<footer>
  Copyright © 2016 Café JavaJam<br>
  <a href="mailto:yourfirstname@yourlastname.com">yourfistname@yourlastname.com</a>
</footer>

<script>
  function openModal(name) {
    document
            .querySelector(`.modal[data-name='${name}']`)
            .classList.add("open");
  }

  function setupNav() {
    document
            .querySelector("button.menu-toggle")
            .addEventListener("click", () => {
              document
                      .querySelector("nav.menu")
                      .classList.toggle("open");
            });
    document.querySelectorAll("nav a").forEach((link) => {
      link.addEventListener("click", (event) => {
        event.preventDefault();
        document
                .querySelector("nav.menu")
                .classList.toggle("open");

        const modalName = event.target.getAttribute(
                "data-modal-name"
        );
        openModal(modalName);
      });
    });
  }

  function setupModals() {
    document.querySelectorAll(".modal").forEach((modal) => {
      modal.addEventListener("click", (event) => {
        if (event.originalTarget === modal) {
          modal.classList.remove("open");
        }
      });
      modal
              .querySelector("button.close")
              .addEventListener("click", () => {
                modal.classList.remove("open");
              });
    });
  }

  document.addEventListener("DOMContentLoaded", function () {
    setupNav();
    setupModals();

    // Allow setting various flags and options via the hash fragment
    const hash = location.hash.length
            ? location.hash.substring(1)
            : "";
    const flags = hash.split(",");

    // Debug mode
    if (flags.includes("debug")) {
      // Force refreshing CSS in debug mode
      const style = document.getElementById("style");
      style.setAttribute(
              "href",
              style.getAttribute("href") + "?" + Date.now()
      );

      document.querySelector(".debug-menu-item").style.display =
              "block";
    }

    // Initialize the heart rate monitor
    const bpmElement = document.getElementById("bpm-value");
    heartRateMonitor.initialize({
      videoElement: document.getElementById("camera-feed"),
      samplingCanvas: document.getElementById("sampling-canvas"),
      graphCanvas: document.getElementById("graph-canvas"),
      graphColor: getComputedStyle(
              document.documentElement
      ).getPropertyValue("--graph-color"),
      graphWidth: 6,
      onBpmChange: (bpm) => (bpmElement.innerText = bpm),
    });

    document
            .getElementById("bpm-display-container")
            .addEventListener(
                    "click",
                    heartRateMonitor.toggleMonitoring
            );

    document.documentElement.addEventListener("keyup", (event) => {
      if (event.key === " ") {
        heartRateMonitor.toggleMonitoring();
      }
    });
  });
</script>
</body>

</html>